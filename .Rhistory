remove.packages("sqldf")
remove.packages("sqldf")
install.packages("MatchIt")
knitr::opts_chunk$set(echo = TRUE)
library(AER)
library(MatchIt)
library(dplyr)
library(ggplot2)
library(lme4)
# Mixed effects model
fit2 <- lmer(fr ~ jail + (1 | state), data = dta_m)
data("Fatalities")
data = Fatalities
#Impute values for missing CA data
data[28,15] = as.factor("no")
data[28,16] = as.factor("no")
#head(data)
#dim(data)
data['fr'] = data$fatal/data$pop*10000
mod_match = matchit(jail ~ year + spirits + unemp + income + beertax + baptist + mormon + drinkage + dry + youngdrivers + miles + breath + pop + gsp, method = "nearest", data = data)
library(MatchIt)
library(dplyr)
library(ggplot2)
library(lme4)
library(AER)
data("Fatalities")
data = Fatalities
#Impute values for missing CA data
data[28,15] = as.factor("no")
data[28,16] = as.factor("no")
#head(data)
#dim(data)
data['fr'] = data$fatal/data$pop*10000
data$jail = ifelse(data$jail == 'yes', 1, 0)
m_ps = glm(jail ~ year + spirits + unemp + income + beertax + baptist + mormon + drinkage + dry + youngdrivers + miles + breath + pop + gsp, family = binomial(), data = data)
summary(m_ps)
prs_df = data.frame(pr_score = predict(m_ps, type = "response"),
jail = m_ps$model$jail)
#head(prs_df)
#dim(prs_df)
labs = paste("Actual jail law implemented:", c("Yes", "No"))
prs_df %>%
mutate(jail = ifelse(jail == 1, labs[1], labs[2])) %>%
ggplot(aes(x = pr_score)) +
geom_histogram(color = "white", bins = 30) +
facet_wrap(~jail) +
xlab("Probability of implementing mandatory jail sentence") +
theme_bw()
data_cov = c("year", "spirits" , "unemp" , "income" , "beertax" , "baptist" , "mormon" , "drinkage" , "dry" , "youngdrivers" , "miles" , "breath" , "pop" , "gsp")
mod_match = matchit(jail ~ year + spirits + unemp + income + beertax + baptist + mormon + drinkage + dry + youngdrivers + miles + breath + pop + gsp, method = "nearest", data = data)
dta_m = match.data(mod_match)
#dim(dta_m)
mod_match = matchit(jail ~ year + spirits + unemp + income + beertax + baptist + mormon + drinkage + dry + youngdrivers + miles + breath + pop + gsp, method = "nearest", data = data)
dta_m = match.data(mod_match)
# Mixed effects model
fit2 <- lmer(fr ~ jail + (1 | state), data = dta_m)
summary(fit2)
plot(fit2, which = c(2))
plot(fit2, which = c(1))
hist(fit2$residuals, main = "Histogram of Residuals", xlab = "Residual Values")
plot(fit2)
qqnorm(residuals(fit2))
plot.qqline(residuals(fit2))
plot.qqline(residuals(fit2))
qqnorm(residuals(fit2))
qqline(residuals(fit2), col = "red")
hist(residuals(fit2), main = "Histogram of Residuals", xlab = "Residual Values")
qqnorm(residuals(fit2))
qqline(residuals(fit2), col = "red")
shapiro.test(residuals(fit2))
bptest(fit2)
install.packages("LMERConvenienceFunctions")
library(AER)
library(MatchIt)
library(dplyr)
library(ggplot2)
library(lme4)
library(car)
leveneTest(residuals(fit2) ~ dta_m$jail)
fit3 <- lmer(log(fr) ~ jail + (1 | state), data = dta_m)
summary(fit3)
summary(fit2)
str(fit3)
qqnorm(residuals(fit3))
qqline(residuals(fit3), col = "red")
hist(residuals(fit3), main = "Histogram of Residuals", xlab = "Residual Values")
plot(fit3)
shapiro.test(residuals(fit3))
qqnorm(residuals(fit3))
qqline(residuals(fit3), col = "red")
hist(residuals(fit3), main = "Histogram of Residuals", xlab = "Residual Values")
plot(fit3)
fit3 <- lmer(ln(fr) ~ jail + (1 | state), data = dta_m)
fit4 <- lmer(log10(fr) ~ jail + (1 | state), data = dta_m)
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
fit4 <- lmer(1/(fr) ~ jail + (1 | state), data = dta_m)
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
hist(residuals(fit4), main = "Histogram of Residuals", xlab = "Residual Values")
hist(residuals(fit4), main = "Histogram of Residuals", xlab = "Residual Values")
plot(fit4)
shapiro.test(residuals(fit4))
fit4 <- lmer(sqrt(fr) ~ jail + (1 | state), data = dta_m)
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
qqnorm(residuals(fit4))
qqline(residuals(fit4), col = "red")
library(AER)
library(MatchIt)
library(dplyr)
library(ggplot2)
library(lme4)
library(car)
library(MASS)
boxcox(fit2)
studres(fit2)
ggplot(data.frame(lev=hatvalues(fit2),pearson=residuals(fit2,type="pearson")),
aes(x=lev,y=pearson)) +
geom_point() +
theme_bw()
qqnorm(residuals(fit2, type="pearson"))
qqline(residuals(fit2, type="pearson"), col = "red")
qqnorm(residuals(fit2, type="pearson"))
qqline(residuals(fit2, type="pearson"), col = "red")
shapiro.test(residuals(fit3, type="pearson"))
shapiro.test(residuals(fit3, type="pearson"))
install.packages("influence.ME")
library(influence.ME)
infl <- influence(fit2)
infl <- influence(fit2, obs=TRUE)
plot(infl, which = "cook")
